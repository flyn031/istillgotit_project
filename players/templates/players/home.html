{# players/templates/players/home.html #}
{% extends 'base.html' %} {# Extend your base template #}
{% load static %} {# Load static files if needed #}
{% load i18n %} {# Keep load i18n if used elsewhere #}
{# REMOVED: {% load custom_filters %} #}

{% block title %}Dashboard - I Still Got It{% endblock %}

{# Added body_id for potential homepage-specific CSS #}
{% block body_id %}page-home-dashboard{% endblock body_id %}
{% block body_attributes %}{% endblock body_attributes %}

{% block content %} {# Start of main content block #}

    {# --- Content based on Authentication Status --- #}
    {% if not user.is_authenticated %} {# Start: Logged-out User Block #}
        {# Logged-out User View - Full Viewport Hero #}
        <div class="hero-section d-flex align-items-end justify-content-center text-center text-white vh-100">
            <div class="hero-overlay"></div>
            <div class="container position-relative pb-5 mb-4" style="z-index: 2; background-color: transparent !important;">
                {# Adjusted layout for buttons #}
                <div class="d-flex flex-column flex-sm-row justify-content-center align-items-center gap-3" style="background-color: transparent !important;">
                    <a href="{% url 'players:signup' %}" class="btn btn-warning btn-lg px-4 fw-bold">Create My Profile</a>
                    <a href="{% url 'players:browse_profiles' %}" class="btn btn-dark btn-lg px-4 fw-bold">Browse All Talent</a>
                </div>
                {# Sport buttons moved below general browse #}
                 <div class="d-flex flex-wrap justify-content-center align-items-center gap-2 mt-3" style="background-color: transparent !important;">
                    <span class="d-inline-block me-2 text-nowrap">Or Browse By Sport:</span> {# Label for sport buttons #}
                    <a href="{% url 'players:browse_profiles' %}?sport={{ 'Soccer'|urlencode }}" class="btn btn-secondary btn-sm px-3 fw-bold">Soccer</a>
                    <a href="{% url 'players:browse_profiles' %}?sport={{ 'Cricket'|urlencode }}" class="btn btn-secondary btn-sm px-3 fw-bold">Cricket</a>
                    <a href="{% url 'players:browse_profiles' %}?sport={{ 'Rugby'|urlencode }}" class="btn btn-secondary btn-sm px-3 fw-bold">Rugby</a>
                </div>
            </div>
        </div> {# End Hero Section #}
        {# Add a separator or margin below the hero for logged-out users #}
        <div class="container"><hr class="my-5"></div>
    {% endif %} {# End: Logged-out User Block (for hero) #}


    {# Main content container, includes both authenticated dashboard and featured videos #}
    {# This container exists regardless of authentication status, but its internal content depends on it #}
    <div class="container py-5">

        {% if user.is_authenticated %} {# Start: Logged-in User Dashboard Block #}
            {# Logged-in User Dashboard Content #}
            <h1 class="display-5 mb-4 text-center">Dashboard</h1>
            <p class="lead text-center">Welcome back, {{ user.username }}!</p>

            <hr class="my-5">

            {# --- Premium vs Free Content Sections --- #}
            {% if is_premium %} {# Start: Premium User Block #}
                {# --- Premium User Dashboard --- #}
                <div class="alert alert-success text-center" role="alert">
                    You are a Premium member! Enjoy unlimited access and premium features.
                </div>

                 {# --- Stat Rankings (Premium Feature) --- #}
                <h2 class="mb-4">Stat Rankings</h2>
                <p class="lead text-center">See how players rank on key metrics.</p>

                {% if stat_rankings %} {# Start: If Stat Rankings Exist #}
                    <div class="row">
                        {% for stat_name, rankings in stat_rankings.items %} {# Start: For Loop Rankings #}
                            <div class="col-md-6 mb-4">
                                <div class="card shadow-sm">
                                    <div class="card-header bg-light">
                                        <strong>{{ stat_name }}</strong>
                                    </div>
                                    <ul class="list-group list-group-flush">
                                        {% for entry in rankings %} {# Start: For Loop Entries #}
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    <span>
                                                        {{ forloop.counter }}.
                                                        {# Link to player profile #}
                                                        {% if entry.player_profile %} {# Check if entry is a PhysicalStat object #}
                                                            <a href="{% url 'players:profile_detail_pk' pk=entry.player_profile.pk %}" class="text-dark text-decoration-none">
                                                                {{ entry.player_profile.user.username }}
                                                                {# --- MODIFIED CODE: Display Player Level in Ranking (Parentheses Removed) --- #}
                                                                <span class="player-level level-{{ entry.player_profile.player_level|lower|slugify }} ms-2">
                                                                    {{ entry.player_profile.player_level }}
                                                                </span>
                                                                {# --- END MODIFIED CODE --- #}
                                                            </a>
                                                        {% else %} {# Assume entry is an annotated PlayerProfile object #}
                                                             <a href="{% url 'players:profile_detail_pk' pk=entry.pk %}" class="text-dark text-decoration-none">
                                                                {{ entry.user.username }}
                                                                {# --- MODIFIED CODE: Display Player Level in Ranking (Parentheses Removed) --- #}
                                                                {# Note: 'entry' is the PlayerProfile here #}
                                                                <span class="player-level level-{{ entry.player_level|lower|slugify }} ms-2">
                                                                    {{ entry.player_level }}
                                                                </span>
                                                                {# --- END MODIFIED CODE --- #}
                                                             </a>
                                                        {% endif %}
                                                    </span>
                                                    <span class="badge bg-primary rounded-pill">
                                                         {# Display the relevant stat value #}
                                                        {% if stat_name == '100m Sprint (Top 10)' or stat_name == 'Vertical Jump (Top 10)' or stat_name == 'Broad Jump (Top 10)' %}
                                                            {{ entry.stat_value_numeric|floatformat:2 }} {{ entry.get_stat_unit_display|default:"" }}
                                                        {% elif stat_name == 'Total Soccer Goals (Top 10)' %}
                                                            {{ entry.total_goals|default:"0" }} goals
                                                        {% elif stat_name == 'Total Cricket Runs (Top 10)' %}
                                                            {{ entry.total_runs|default:"0" }} runs
                                                        {% elif stat_name == 'Total Cricket Wickets (Top 10)' %}
                                                            {{ entry.total_wickets|default:"0" }} wickets
                                                        {% elif stat_name == 'Total Rugby Tries (Top 10)' %}
                                                            {{ entry.total_tries|default:"0" }} tries
                                                        {% elif stat_name == 'Total Rugby Tackles (Top 10)' %}
                                                            {{ entry.total_tackles|default:"0" }} tackles
                                                        {% else %}
                                                            N/A {# Fallback if stat_name doesn't match #}
                                                        {% endif %}
                                                    </span>
                                                </li>
                                            {% endfor %} {# End: For Loop Entries #}
                                    </ul>
                                </div>
                            </div>
                        {% endfor %} {# End: For Loop Rankings #}
                    </div> {# End Stat Rankings row #}

                 {# Check again if stat_rankings is empty, outside the loop #}
                 {% if not stat_rankings %} {# Start: If NO Stat Rankings Exist #}
                    <div class="col-12">
                        <div class="alert alert-light text-center" role="alert">
                            Stat rankings are being calculated or no data is available yet for rankings.
                        </div>
                    </div>
                 {% endif %} {# End: If NO Stat Rankings Exist #}

                {% else %} {# Start: Else NO Stat Rankings (i.e. stat_rankings is empty) #}
                    <div class="alert alert-info text-center" role="alert">
                        Stat rankings will appear here soon!
                    </div>
                {% endif %} {# End: If Stat Rankings Exist #}

                 <hr class="my-5">

                {# --- Player List (Unlimited for Premium) --- #}
                <h2 class="mb-4">All Player Profiles</h2>
                <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                    {% for profile in player_profiles_for_display %} {# Start: For Loop Profiles (Premium) #}
                        <div class="col">
                            <div class="card h-100 shadow-sm">
                                 {# Example card structure - customize as needed #}
                                 <a href="{% url 'players:profile_detail_pk' pk=profile.pk %}" class="text-decoration-none text-dark" aria-label="View {{ profile.user.username }}'s profile">
                                    {% if profile.avatar %}
                                        <img src="{{ profile.avatar.url }}" class="card-img-top" alt="{{ profile.user.username }} Avatar" style="height: 200px; object-fit: cover;">
                                    {% else %}
                                        {# Using a placeholder SVG #}
                                        <svg class="bd-placeholder-img card-img-top bg-secondary" width="100%" height="200" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Placeholder: Avatar" preserveAspectRatio="xMidYMid slice" focusable="false"><title>Placeholder</title><rect width="100%" height="100%" fill="#6c757d"></rect><text x="50%" y="50%" fill="#dee2e6" dy=".3em" text-anchor="middle">No Avatar</text></svg> {# Corrected fill color #}
                                    {% endif %}
                                </a>
                                <div class="card-body d-flex flex-column">
                                    <h5 class="card-title mb-1">
                                        <a href="{% url 'players:profile_detail_pk' pk=profile.pk %}" class="text-decoration-none text-dark stretched-link">
                                             {{ profile.user.username }}
                                        </a>
                                        {# --- MODIFIED CODE: Display Player Level on Card (Parentheses Removed) --- #}
                                        <span class="player-level level-{{ profile.player_level|lower|slugify }} ms-1"> {# Added ms-1 margin #}
                                            {{ profile.player_level }}
                                        </span>
                                        {# --- END MODIFIED CODE --- #}
                                    </h5>
                                     <p class="card-text small text-muted mb-2">({{ profile.get_primary_sport_display|capfirst }})</p> {# Sport below name #}
                                    {% if profile.city or profile.country %}
                                         <p class="card-text small text-muted mb-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" class="bi bi-geo-alt-fill me-1" viewBox="0 0 16 16"> <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/> </svg>
                                            {{ profile.city|default:"" }}{% if profile.city and profile.country %}, {% endif %">{{ profile.country|default:"" }}
                                         </p>
                                     {% else %}
                                        <p class="card-text small text-muted mb-2">Location: Not set</p>
                                     {% endif %}
                                     {# Optional: Show aggregated stats on card #}
                                     {% comment %}
                                     <p class="card-text small">Views: {{ profile.total_videos_views }} | Rating: {{ profile.overall_average_rating }}</p>
                                     {% endcomment %}
                                    {# Link to profile detail - ALWAYS enabled for Premium #}
                                    {# Stretched-link on title makes this button redundant unless you prefer it #}
                                    {% comment %} <a href="{% url 'players:profile_detail_pk' pk=profile.pk %}" class="btn btn-primary btn-sm mt-auto">View Profile</a> {% endcomment %}
                                </div>
                            </div>
                        </div>
                    {% empty %}
                        <div class="col-12">
                            <div class="alert alert-light text-center" role="alert">
                                No player profiles available.
                            </div>
                        </div>
                    {% endfor %} {# End: For Loop Profiles (Premium) #}
                </div> {# End Player Profiles row #}


            {% else %} {# Start: Else (Free User Block) #}
                {# --- Free User Dashboard --- #}
                <div class="alert alert-info text-center" role="alert">
                    You are a Free member. You can view up to {{ view_limit }} player profiles per month.
                    You have viewed {{ profiles_viewed_this_month }} profiles this month.
                </div>

                {% if not can_view_more_profiles %} {# Start: If Limit Reached #}
                    <div class="alert alert-warning text-center" role="alert">
                        You have reached your profile view limit for this month. Subscribe to Premium for unlimited views!
                        {# TODO: Link to your actual subscription/pricing page #}
                        <a href="#" class="alert-link">Learn about Premium</a>
                    </div>
                {% endif %} {# End: If Limit Reached #}

                 {# --- Stat Rankings Teaser (Free Feature) --- #}
                 <div class="card bg-light mb-5 shadow-sm"> {# Added mb-5 #}
                    <div class="card-body text-center">
                        <h5 class="card-title">See How You Stack Up!</h5>
                        <p class="card-text">Premium members get access to site-wide stat rankings and comparisons.</p>
                        {# TODO: Link to your actual subscription/pricing page #}
                        <a href="#" class="btn btn-success btn-lg">Go Premium to See Rankings</a>
                    </div>
                </div>
                {# --- End Stat Rankings Teaser --- #}


                {# --- Player List (Links conditionally enabled for Free) --- #}
                <h2 class="mb-4">Browse Player Profiles</h2>
                 <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                    {% for profile in player_profiles_for_display %} {# Start: For Loop Profiles (Free) #}
                        <div class="col">
                            <div class="card h-100 shadow-sm text-center">
                                 {# Link enabled/disabled based on view limit #}
                                {% if can_view_more_profiles %}
                                    <a href="{% url 'players:profile_detail_pk' pk=profile.pk %}" class="text-decoration-none text-dark" aria-label="View {{ profile.user.username }}'s profile">
                                {% else %}
                                     {# Prevent click if limit reached, maybe use a div #}
                                     <div class="no-link"> {# Custom class for styling, prevent pointer #}
                                 {% endif %}

                                     {% if profile.avatar %}
                                         <img src="{{ profile.avatar.url }}" class="card-img-top" alt="{{ profile.user.username }} Avatar" style="height: 200px; object-fit: cover;">
                                     {% else %}
                                         <svg class="card-img-top bg-secondary" width="100%" height="200" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Placeholder: Avatar" preserveAspectRatio="xMidYMid slice" focusable="false"><title>Placeholder</title><rect width="100%" height="100%" fill="#6c757d"></rect><text x="50%" y="50%" fill="#dee2e6" dy=".3em" text-anchor="middle">No Avatar</text></svg> {# Corrected fill color #}
                                     {% endif %}

                                {% if can_view_more_profiles %} </a> {% else %} </div> {% endif %}


                                <div class="card-body d-flex flex-column position-relative">
                                    <h5 class="card-title mb-1">
                                        {# Link title only if clickable #}
                                        {% if can_view_more_profiles %}
                                            <a href="{% url 'players:profile_detail_pk' pk=profile.pk %}" class="text-decoration-none text-dark stretched-link">
                                                {{ profile.user.username }}
                                            </a>
                                        {% else %}
                                            {{ profile.user.username }}
                                        {% endif %}
                                        {# --- MODIFIED CODE: Display Player Level on Card (Parentheses Removed) --- #}
                                        <span class="player-level level-{{ profile.player_level|lower|slugify }} ms-1"> {# Added ms-1 margin #}
                                            {{ profile.player_level }}
                                        </span>
                                        {# --- END MODIFIED CODE --- #}
                                    </h5>
                                     <p class="card-text small text-muted mb-2">({{ profile.get_primary_sport_display|capfirst }})</p> {# Sport below name #}
                                    {% if profile.city or profile.country %}
                                         <p class="card-text small text-muted mb-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" class="bi bi-geo-alt-fill me-1" viewBox="0 0 16 16"> <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/> </svg>
                                            {{ profile.city|default:"" }}{% if profile.city and profile.country %}, {% endif %>{{ profile.country|default:"" }}
                                         </p>
                                     {% else %}
                                        <p class="card-text small text-muted mb-2">Location: Not set</p>
                                     {% endif %}
                                     {# Optional: Show aggregated stats on card #}
                                     {% comment %}
                                     <p class="card-text small">Views: {{ profile.total_videos_views }} | Rating: {{ profile.overall_average_rating }}</p>
                                     {% endcomment %}

                                    {% if can_view_more_profiles %} {# Start: If Can View More #}
                                        {# Allow clicking through if the user has views remaining #}
                                        {# Stretched-link on title makes this button redundant unless you prefer it #}
                                        {% comment %} <a href="{% url 'players:profile_detail_pk' pk=profile.pk %}" class="btn btn-primary btn-sm mt-auto">View Profile</a> {% endcomment %}
                                    {% else %} {# Start: Else Cannot View More #}
                                        {# Disable the link or show a different button if limit reached #}
                                        <button class="btn btn-secondary btn-sm mt-auto" disabled>View Profile (Limit Reached)</button>
                                    {% endif %} {# End: If Can View More #}
                                </div>
                            </div>
                        </div>
                    {% empty %}
                         <div class="col-12">
                            <div class="alert alert-light text-center" role="alert">
                                No player profiles available.
                            </div>
                        </div>
                    {% endfor %} {# End: For Loop Profiles (Free) #}
                </div> {# End Player Profiles row #}

                <hr class="my-5">

                {# --- Premium Feature Teaser (General) --- #}
                <div class="card bg-light mb-3 shadow-sm">
                    <div class="card-body text-center">
                        <h5 class="card-title">Unlock the Full Experience</h5>
                        <p class="card-text">Go Premium to get unlimited profile views, access stat rankings, and more!</p>
                        {# TODO: Link to your actual subscription/pricing page #}
                        <a href="#" class="btn btn-success btn-lg">Go Premium</a>
                    </div>
                </div>

            {% endif %} {# End: Premium User Block #}

             {# --- Sections for ALL LOGGED-IN USERS (regardless of tier) --- #}
            <hr class="my-5">
            <h2 class="text-center mb-4">Your Hub</h2>
            <div class="row text-center">
                <div class="col-md-4 mb-3">
                    <div class="card shadow-sm h-100">
                        <div class="card-body">
                            <h5 class="card-title">Your Profile</h5>
                            <p class="card-text">View and manage your personal details, bio, and contact info.</p>
                            <a href="{% url 'players:profile_detail' %}" class="btn btn-outline-primary">Go to Profile</a>
                        </div>
                    </div>
                </div>
                 <div class="col-md-4 mb-3">
                    <div class="card shadow-sm h-100">
                         <div class="card-body">
                            <h5 class="card-title">Add Stats</h5> {# Simplified title #}
                            <p class="card-text">Record your physical stats and match performance.</p> {# Adjusted text #}
                            <a href="{% url 'players:add_match_record' %}" class="btn btn-outline-primary me-2">Add Match</a>
                            <a href="{% url 'players:add_physical_stat' %}" class="btn btn-outline-primary">Add Physical Stat</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card shadow-sm h-100">
                         <div class="card-body">
                            <h5 class="card-title">Upload Videos</h5>
                            <p class="card-text">Share your highlight reels and game footage.</p>
                            <a href="{% url 'players:video_upload' %}" class="btn btn-outline-primary">Upload Video</a>
                         </div>
                    </div>
                </div>
            </div>
            {# --- End Your Hub --- #}

        {% endif %} {# End: Logged-in User Dashboard Block #}


        {# --- Featured Videos Section (Shows for ALL users) --- #}
        {# This section is now outside the main authenticated check but inside the container #}
        <hr class="my-5"> {# Separator before Featured Videos #}
        <h2 class="text-center mb-4">Featured Videos</h2>

        {% if featured_videos %} {# Start: If Featured Videos Exist #}
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                {% for video in featured_videos %} {# Start: For Loop Featured Videos #}
                    <div class="col">
                        <div class="card h-100 shadow-sm">
                            <a href="{% url 'players:video_detail' pk=video.pk %}" class="text-decoration-none">
                                {# --- Display Thumbnail or Fallback --- #}
                                <div class="ratio ratio-16x9 bg-light"> {# Background for fallback #}
                                    {% if video.thumbnail %} {# Start: If Thumbnail #}
                                        <img src="{{ video.thumbnail.url }}" alt="Thumbnail for {{ video.title }}" class="card-img-top" style="object-fit: cover;">
                                    {% else %} {# Start: Else Thumbnail #}
                                        {# Fallback icon centered #}
                                        <div class="d-flex align-items-center justify-content-center text-muted">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-film" viewBox="0 0 16 16"> <path d="M0 1a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V1zm4 0v6h8V1H4zm8 8H4v6h8V9zM1 1v2h2V1H1zm2 3H1v2h2V4zM1 7v2h2V7H1zm2 3H1v2h2v-2zm-2 3v2h2v-2H1zM15 1h-2v2h2V1zm-2 3v2h2V4h-2zm2 3h-2v2h2V7zm-2 3v2h2v-2h-2zm2 3h-2v2h2v-2z"/> </svg>
                                        </div>
                                    {% endif %} {# End: If Thumbnail #}
                                </div>
                                {# --- End Thumbnail Display --- #}
                            </a>
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">
                                    <a href="{% url 'players:video_detail' pk=video.pk %}" class="text-decoration-none text-dark stretched-link">
                                        {{ video.title }}
                                    </a>
                                     {# --- MODIFIED CODE: Display Video Level on Card (Parentheses Removed) --- #}
                                    <span class="video-level level-{{ video.level|lower|slugify }} ms-1"> {# Added ms-1 margin #}
                                        {{ video.level }}
                                    </span>
                                     {# --- END MODIFIED CODE --- #}
                                </h5>
                                <p class="card-text small mb-1">
                                    By: <a href="{% url 'players:profile_detail_pk' pk=video.player_profile.pk %}" class="text-muted">{{ video.player_profile.user.username }}</a>
                                </p>
                                <p class="card-text small text-muted">
                                    {{ video.uploaded_at|date:"M d, Y" }} | Views: {{ video.view_count }}
                                    {# --- NEW CODE: Display Average Rating on Card --- #}
                                    | Rating: {{ video.average_rating }}/5
                                     {# --- END NEW CODE --- #}
                                    {% if video.is_featured %}<span class="badge bg-warning text-dark ms-1">Featured</span>{% endif %}
                                </p>
                                {% if video.description %} {# Start: If Description #}
                                    <p class="card-text small mt-auto pt-2">{{ video.description|truncatewords:15 }}</p> {# Truncated description at the bottom #}
                                {% endif %} {# End: If Description #}
                            </div>
                            {# Optional: Add footer link again if desired
                            <div class="card-footer bg-transparent border-top-0 text-end">
                                <a href="{% url 'players:video_detail' pk=video.pk %}" class="btn btn-sm btn-outline-primary">Watch</a>
                            </div>
                            #}
                        </div>
                    </div>
                {% empty %} {# Start: Empty Featured Videos #}
                    <div class="col">
                        <div class="alert alert-light text-center" role="alert">
                            No featured videos available at the moment. Check back soon!
                        </div>
                    </div>
                {% endfor %} {# End: For Loop Featured Videos #}
            </div> {# End row #}
        {% endif %} {# End: If Featured Videos Exist #}
    </div> {# End main content container #}
    {# --- End Featured Videos Section --- #}


{% endblock content %} {# Correctly matched endblock for block content #}


{% block extra_css %} {# Start: block extra_css #}
{# --- CSS specific to the hero section --- #}
<style>
    /* Apply height 100% only needed if hero IS the only content, adjust if needed */
    /* html, body#page-home { height: 100%; } */

    .hero-section {
        position: relative;
        background-image: url("{% static 'players/images/homepage_hero.png' %}");
        background-size: cover;
        background-position: center center;
        background-repeat: no-repeat;
        /* height: 100vh; */ /* Use vh unit for viewport height */
        min-height: 400px; /* Ensure hero has minimum height */
        /* overflow: hidden; */ /* Might hide content below if body doesn't scroll */
    }

    .hero-overlay {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background-color: rgba(44, 62, 80, 0.7); /* Adjust opacity as needed */
        z-index: 1;
    }

    /* Button Styling */
    /* REMOVED: .hero-section .btn-lg { color: #fff !important; } */
    .hero-section .btn-warning { background-color: #f0ad4e; border-color: #eea236; }
    .hero-section .btn-warning:hover { background-color: #ec971f; border-color: #d58512; }
    .hero-section .btn-dark { background-color: #343a40; border-color: #212529; opacity: 0.9; }
    .hero-section .btn-dark:hover { background-color: #23272b; border-color: #1d2124; opacity: 1; }
    .hero-section .btn-secondary { background-color: #6c757d; border-color: #565e64; opacity: 0.9; }
    .hero-section .btn-secondary:hover { background-color: #565e64; border-color: #404549; opacity: 1; }

    /* Ensure body allows scrolling if content exceeds viewport */
    /* Removed #page-home as dashboard page uses a different ID */
    body#page-home-dashboard {
        overflow-y: auto;
    }
    body#page-home { /* Keep this if you still use 'page-home' for the logged out hero */
         overflow-y: auto;
         /* Adjust body padding for the hero section specifically */
         padding-top: 0; /* Remove padding for the hero */
    }


    /* Style for the image within the ratio div */
    .ratio img.card-img-top {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover; /* Ensure image covers the area */
    }

    /* --- ADDED: Attempt to fix button vertical alignment --- */
    .hero-section .d-flex > .btn {
        vertical-align: middle !important; /* Explicitly set vertical alignment, use !important as a test */
    }
    /* --- END ADDED --- */

    /* Custom class to prevent pointer cursor when link is disabled */
    .no-link {
        cursor: default;
        pointer-events: none; /* Prevents click */
        opacity: 0.7; /* Visually indicate it's not interactive */
    }

</style>
{% endblock extra_css %} {# Correctly matched endblock for block extra_css #}